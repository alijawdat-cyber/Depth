<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Depth Documentation - مكوّن HeaderSidebar المتكامل</title>
    
    <!-- Docsify Theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="custom-theme.css">
    <link rel="stylesheet" href="HeaderSidebar.css">
    
    <style>
        /* تكامل مع docsify */
        .app-name {
            display: none !important;
        }
        
        .sidebar-toggle {
            display: none !important;
        }
        
        /* تعديل المحتوى للهيدر الجديد */
        .content {
            padding-top: 20px;
        }
        
        /* إخفاء السايدبار الأصلي في الموبايل */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(100%);
            }
        }
        
        /* تحسينات إضافية */
        .demo-status {
            position: fixed;
            top: 80px;
            left: 20px;
            background: var(--depth-purple-500);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 999;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .integration-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .integration-info h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .integration-info p {
            margin: 0;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Status Indicator -->
    <div class="demo-status">
        🚀 HeaderSidebar Active
    </div>
    
    <!-- HeaderSidebar Container -->
    <div id="header-sidebar-container"></div>
    
    <!-- Main Docsify App -->
    <div id="app">جاري التحميل...</div>
    
    <!-- Integration Info -->
    <script>
        // بيانات التنقل مستخرجة من _sidebar.md
        const NAVIGATION_DATA = [
            {
                id: 'home',
                label: 'الرئيسية',
                href: '#/',
            },
            {
                id: 'start',
                label: 'البداية',
                href: '#/documentation/01-requirements/00-requirements-v2.0',
                children: [
                    {
                        id: 'requirements',
                        label: 'المتطلبات',
                        href: '#/documentation/01-requirements/00-requirements-v2.0'
                    }
                ]
            },
            {
                id: 'database',
                label: 'قاعدة البيانات',
                href: '#/documentation/02-database/00-data-dictionary',
                children: [
                    {
                        id: 'data-dict',
                        label: 'قاموس البيانات',
                        href: '#/documentation/02-database/00-data-dictionary'
                    },
                    {
                        id: 'schema',
                        label: 'مخطط قاعدة البيانات',
                        href: '#/documentation/02-database/01-database-schema'
                    },
                    {
                        id: 'indexes',
                        label: 'الفهارس والاستعلامات',
                        href: '#/documentation/02-database/02-indexes-and-queries'
                    }
                ]
            },
            {
                id: 'api',
                label: 'الأساسيات',
                href: '#/documentation/03-api/core/01-authentication',
                children: [
                    {
                        id: 'auth',
                        label: 'المصادقة',
                        href: '#/documentation/03-api/core/01-authentication'
                    },
                    {
                        id: 'rate-limit',
                        label: 'تحديد المعدل',
                        href: '#/documentation/03-api/core/02-rate-limiting'
                    },
                    {
                        id: 'websockets',
                        label: 'WebSockets',
                        href: '#/documentation/03-api/core/03-websockets'
                    },
                    {
                        id: 'errors',
                        label: 'معالجة الأخطاء',
                        href: '#/documentation/03-api/core/04-error-handling'
                    }
                ]
            },
            {
                id: 'features',
                label: 'المميزات',
                href: '#/documentation/03-api/features/01-creators',
                children: [
                    {
                        id: 'creators',
                        label: 'المبدعون',
                        href: '#/documentation/03-api/features/01-creators'
                    },
                    {
                        id: 'clients',
                        label: 'العملاء',
                        href: '#/documentation/03-api/features/02-clients'
                    },
                    {
                        id: 'projects',
                        label: 'المشاريع',
                        href: '#/documentation/03-api/features/03-projects'
                    },
                    {
                        id: 'pricing',
                        label: 'التسعير',
                        href: '#/documentation/03-api/features/04-pricing'
                    }
                ]
            },
            {
                id: 'development',
                label: 'التطوير',
                href: '#/documentation/04-development/00-getting-started',
                children: [
                    {
                        id: 'getting-started',
                        label: 'دليل المطورين',
                        href: '#/documentation/04-development/00-getting-started'
                    },
                    {
                        id: 'local-setup',
                        label: 'الإعداد المحلي',
                        href: '#/documentation/04-development/01-local-setup'
                    },
                    {
                        id: 'workflow',
                        label: 'سير العمل',
                        href: '#/documentation/04-development/03-development-workflow'
                    }
                ]
            },
            {
                id: 'security',
                label: 'الأمان',
                href: '#/documentation/07-security/00-security-overview',
                children: [
                    {
                        id: 'security-overview',
                        label: 'نظرة عامة',
                        href: '#/documentation/07-security/00-security-overview'
                    },
                    {
                        id: 'threat-model',
                        label: 'نموذج التهديدات',
                        href: '#/documentation/07-security/01-threat-model'
                    }
                ]
            }
        ];

        // HeaderSidebar Class (مضمنة للمثال)
        class HeaderSidebar {
            constructor(container, config) {
                this.container = typeof container === 'string' 
                    ? document.querySelector(container) 
                    : container;
                
                this.navigation = config.navigation;
                this.githubUrl = config.githubUrl || 'https://github.com/alijawdat-cyber/Depth';
                this.sidebarOpen = false;
                this.scrolled = false;
                
                this.init();
            }

            init() {
                this.render();
                this.bindEvents();
                this.updateBreadcrumbs();
                
                // تحديث عند تغيير الهاش
                window.addEventListener('hashchange', () => {
                    this.updateBreadcrumbs();
                    this.updateActiveLinks();
                });
            }

            render() {
                this.container.innerHTML = `
                    <!-- Header -->
                    <header class="header-sidebar-header" role="banner">
                        <div class="header-content">
                            <button class="hamburger-btn" aria-expanded="false" aria-controls="main-sidebar" aria-label="فتح القائمة الجانبية">
                                <svg class="lucide lucide-menu" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="4" x2="20" y1="6" y2="6"/>
                                    <line x1="4" x2="20" y1="12" y2="12"/>
                                    <line x1="4" x2="20" y1="18" y2="18"/>
                                </svg>
                                <svg class="lucide lucide-x" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                    <path d="m18 6-12 12"/>
                                    <path d="m6 6 12 12"/>
                                </svg>
                            </button>

                            <nav class="breadcrumbs-nav" aria-label="Breadcrumb" role="navigation">
                                <ol class="breadcrumbs-list">
                                    <!-- سيتم تحديثها بواسطة JavaScript -->
                                </ol>
                            </nav>

                            <a href="${this.githubUrl}" target="_blank" rel="noopener noreferrer" class="github-link" aria-label="عرض على GitHub">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/>
                                    <path d="M9 18c-4.51 2-5-2-7-2"/>
                                </svg>
                            </a>
                        </div>
                    </header>

                    <div class="sidebar-overlay" aria-hidden="true"></div>

                    <aside id="main-sidebar" class="header-sidebar-nav sidebar-closed" role="navigation" aria-label="القائمة الرئيسية" aria-hidden="true">
                        <div class="sidebar-content">
                            <div class="sidebar-header">
                                <h2 class="sidebar-title">Depth Documentation</h2>
                                <button class="sidebar-close-btn" aria-label="إغلاق القائمة الجانبية">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="m18 6-12 12"/>
                                        <path d="m6 6 12 12"/>
                                    </svg>
                                </button>
                            </div>

                            <nav class="sidebar-nav" role="navigation">
                                <ul class="nav-list">
                                    ${this.generateNavigationHTML()}
                                </ul>
                            </nav>
                        </div>
                    </aside>

                    <div class="header-spacer" aria-hidden="true"></div>
                `;

                // Cache elements
                this.header = this.container.querySelector('.header-sidebar-header');
                this.sidebar = this.container.querySelector('.header-sidebar-nav');
                this.overlay = this.container.querySelector('.sidebar-overlay');
                this.hamburgerBtn = this.container.querySelector('.hamburger-btn');
                this.breadcrumbsList = this.container.querySelector('.breadcrumbs-list');
            }

            generateNavigationHTML() {
                return this.navigation.map(item => this.renderNavItem(item, 0)).join('');
            }

            renderNavItem(item, level) {
                const isActive = window.location.hash === item.href;
                const hasChildren = item.children && item.children.length > 0;
                const padding = 16 + (level * 16);

                let html = `
                    <li class="nav-item nav-item-level-${level}">
                        <a href="${item.href}" class="nav-link ${isActive ? 'nav-link-active' : ''}" style="padding-right: ${padding}px;">
                            ${item.label}
                        </a>
                `;

                if (hasChildren) {
                    html += `
                        <ul class="nav-submenu">
                            ${item.children.map(child => this.renderNavItem(child, level + 1)).join('')}
                        </ul>
                    `;
                }

                html += '</li>';
                return html;
            }

            updateBreadcrumbs() {
                if (!this.breadcrumbsList) return;

                const hash = window.location.hash || '#/';
                const segments = hash.replace('#/', '').split('/').filter(Boolean);
                
                const breadcrumbs = [{ label: 'Home', href: '#/', isLast: segments.length === 0 }];

                let currentPath = '#/';
                segments.forEach((segment, index) => {
                    currentPath += segment + (index < segments.length - 1 ? '/' : '');
                    const isLast = index === segments.length - 1;
                    
                    const cleanSegment = segment
                        .replace(/-/g, ' ')
                        .replace(/_/g, ' ')
                        .replace(/^\d+[\-\s]*/, '')
                        .trim();

                    breadcrumbs.push({
                        label: cleanSegment,
                        href: currentPath,
                        isLast
                    });
                });

                this.breadcrumbsList.innerHTML = breadcrumbs.map(crumb => {
                    if (!crumb.isLast) {
                        return `
                            <li class="breadcrumb-item">
                                <a href="${crumb.href}" class="breadcrumb-link">${crumb.label}</a>
                                <span class="breadcrumb-separator" aria-hidden="true">›</span>
                            </li>
                        `;
                    } else {
                        return `
                            <li class="breadcrumb-item">
                                <span class="breadcrumb-current" aria-current="page">${crumb.label}</span>
                            </li>
                        `;
                    }
                }).join('');
            }

            updateActiveLinks() {
                const currentHash = window.location.hash;
                const links = this.container.querySelectorAll('.nav-link');
                
                links.forEach(link => {
                    if (link.getAttribute('href') === currentHash) {
                        link.classList.add('nav-link-active');
                    } else {
                        link.classList.remove('nav-link-active');
                    }
                });
            }

            bindEvents() {
                this.hamburgerBtn?.addEventListener('click', () => this.toggleSidebar());
                this.container.querySelector('.sidebar-close-btn')?.addEventListener('click', () => this.toggleSidebar());
                this.overlay?.addEventListener('click', () => this.toggleSidebar());
                
                window.addEventListener('scroll', () => this.handleScroll(), { passive: true });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.sidebarOpen) {
                        this.toggleSidebar();
                    }
                });

                this.sidebar?.addEventListener('click', (e) => {
                    if (e.target.classList.contains('nav-link') && window.innerWidth <= 768) {
                        setTimeout(() => this.toggleSidebar(), 150);
                    }
                });
            }

            toggleSidebar() {
                this.sidebarOpen = !this.sidebarOpen;
                
                const menuIcon = this.hamburgerBtn.querySelector('.lucide-menu');
                const closeIcon = this.hamburgerBtn.querySelector('.lucide-x');

                if (this.sidebarOpen) {
                    this.sidebar.classList.remove('sidebar-closed');
                    this.sidebar.classList.add('sidebar-open');
                    this.hamburgerBtn.setAttribute('aria-expanded', 'true');
                    this.sidebar.setAttribute('aria-hidden', 'false');
                    
                    menuIcon.style.display = 'none';
                    closeIcon.style.display = 'block';
                } else {
                    this.sidebar.classList.remove('sidebar-open');
                    this.sidebar.classList.add('sidebar-closed');
                    this.hamburgerBtn.setAttribute('aria-expanded', 'false');
                    this.sidebar.setAttribute('aria-hidden', 'true');
                    
                    menuIcon.style.display = 'block';
                    closeIcon.style.display = 'none';
                }
            }

            handleScroll() {
                const shouldScroll = window.scrollY > 10;
                if (shouldScroll !== this.scrolled) {
                    this.scrolled = shouldScroll;
                    this.header?.classList.toggle('header-scrolled', this.scrolled);
                }
            }
        }

        // تهيئة المكوّن عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            const headerSidebar = new HeaderSidebar('#header-sidebar-container', {
                navigation: NAVIGATION_DATA,
                githubUrl: 'https://github.com/alijawdat-cyber/Depth'
            });

            console.log('🎯 HeaderSidebar initialized successfully!');
        });
    </script>

    <!-- Docsify Configuration -->
    <script src="docsify-config.js"></script>
    
    <!-- Docsify Core -->
    <script src="//cdn.jsdelivr.net/npm/docsify@4/lib/docsify.min.js"></script>
    
    <!-- Docsify Plugins -->
    <script src="//cdn.jsdelivr.net/npm/docsify@4/lib/plugins/search.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify@4/lib/plugins/zoom-image.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify-copy-code@2/dist/docsify-copy-code.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-javascript.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-typescript.min.js"></script>

    <!-- Docsify Configuration -->
    <script>
        window.$docsify = {
            name: 'Depth Documentation',
            repo: 'https://github.com/alijawdat-cyber/Depth',
            loadSidebar: true,
            loadNavbar: false,
            maxLevel: 4,
            subMaxLevel: 3,
            auto2top: true,
            search: 'auto',
            
            // تخصيص المسارات
            basePath: '/',
            homepage: 'documentation/00-overview/00-introduction.md',
            
            // الإضافات
            plugins: [
                window.DepthDocs.docsifyPlugin
            ],
            
            // البحث
            search: {
                placeholder: 'البحث في التوثيق...',
                noData: 'لا توجد نتائج',
                depth: 6
            },
            
            // نسخ الكود
            copyCode: {
                buttonText: 'نسخ',
                errorText: 'خطأ',
                successText: 'تم النسخ'
            }
        };
    </script>
</body>
</html>
