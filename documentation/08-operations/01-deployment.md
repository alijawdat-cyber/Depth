# ๐ ุฏููู ุงููุดุฑ (Deployment Runbook) - Depth V2.0

> ูุตุทูุญุงุช ูุฐุง ุงููุณุชูุฏ:
> - ุงูุชูุงูู/ุงูุชุณููู ุงููุณุชูุฑุงู: Continuous Integration / Continuous Delivery โ CI/CD
> - ูู ุงูุทุฑู ุฅูู ุงูุทุฑู: End-to-End โ E2E
> - ูุฏู ุฒูู ุงูุงุณุชุนุงุฏุฉ: Recovery Time Objective โ RTO
> - ูุฏู ููุทุฉ ุงูุงุณุชุนุงุฏุฉ: Recovery Point Objective โ RPO
> - ูุคุดุฑ ุฃุฏุงุก ุฑุฆูุณู: Key Performance Indicator โ KPI
> (ุงูุธุฑ ุฃูุถูุง: `99-reference/06-terminology-glossary-ar.md`)

## 1. ุงููุฏู
ุชูููุฑ ูุณุงุฑ ููุญุฏุ ูุงุจู ููุชุฏููู ูุขูู ููุดุฑ ุงูููุตุฉ ุนุจุฑ ุงูุจูุฆุงุช (Dev โ Staging โ Production) ูุน ุขููุงุช ูุญุต ูุง ูุจู ููุง ุจุนุฏ ุงููุดุฑ ูุฎุทุฉ ุชุฑุงุฌุน (Rollback).

## 2. ุงูุจูุฆุงุช
| ุงูุจูุฆุฉ | ุงููุฑุน | ุงูุบุฑุถ | ุงููููุฏ | ุฃุฏูุงุช ุงูุฑุตุฏ |
|--------|-------|-------|--------|-------------|
| Dev | feature/* + PR | ุชุฌุงุฑุจ ูุชุทููุฑ | ูุฏ ุชููู ุบูุฑ ูุณุชูุฑุฉ | Local DevTools |
| Staging | develop | ุงุฎุชุจุงุฑ ุชูุงููู / ูุจูู | ูุง ููุฌุฏ ุจูุงูุงุช ุญููููุฉ | Sentry (stg), Vercel Preview |
| Production | main | ูุณุชุฎุฏููู ุญูููููู | ุชุบููุฑุงุช ุญุฑุฌุฉ ููุท | Sentry, Vercel Analytics |

## 3. ุดุฑูุท ูุจูู ุงููุดุฑ ุฅูู Staging
- โ ุฌููุน ุงุฎุชุจุงุฑุงุช ุงููุญุฏุฉ + ุงูุชูุงูู ุฎุถุฑุงุก
- โ ุงูุชุบุทูุฉ โฅ 70% (ูุคูุช) โ ูุฏู 85%
- โ ูุญุต ESLint ู Type Check ุจูุง ุฃุฎุทุงุก
- โ ูุง ุชูุฌุฏ ุชุญุฐูุฑุงุช ุฃูู ุชุจุนูุงุช ุญุฑุฌุฉ (High/Critical)
- โ ูุญุต Link Integrity ูููุซุงุฆู (ุงุฎุชูุงุฑู ุญุงููุงู)

## 4. ุดุฑูุท ูุจูู ุงููุดุฑ ุฅูู Production
| ูุฆุฉ | ุงููุนูุงุฑ | ุฃุฏุงุฉ/ูุตุฏุฑ |
|-----|---------|-----------|
| ุงูุงุฎุชุจุงุฑุงุช | 100% ูุฌุงุญ ุขุฎุฑ Pipeline | GitHub Actions |
| ุงููุฌุฑุฉ/ุงูููุงุฑุณ | ูุง ุชุบููุฑุงุช ูุงุณุฑุฉ (Firestore) | ูุฑุงุฌุนุฉ ูุฏููุฉ |
| ุงูุฃุฏุงุก | ุฒูู ุจูุงุก < 8 ุฏูุงุฆู | Actions Logs |
| ุงูุฃุฎุทุงุก | ูุนุฏู ุฃุฎุทุงุก Sentry (Staging) ููุฎูุถ (<1%) | Sentry |
| ุงูุฃูู | ูุง ุฃุณุฑุงุฑ ููุดููุฉ | ุณุฑูุฉ ุงููุชุบูุฑุงุช + ูุฑุงุฌุนุฉ |
| ุงูููุงููุงุช | ููุงููุฉ Tech + Product | PR Review |

## 5. ุณูุฑ ุงูุนูู (Workflow)
1. ุชุทููุฑ ูู ูุฑุน feature/*
2. ูุชุญ PR ุฅูู develop โ ุงุฎุชุจุงุฑุงุช ุชููุงุฆูุฉ
3. ุฏูุฌ โ ูุดุฑ ุชููุงุฆู Staging (Preview)
4. ุงุฎุชุจุงุฑ ูุจูู (QA + UAT)
5. ูุชุญ PR ูู develop ุฅูู main (Release PR)
6. ูุณู/Tag (ุงุฎุชูุงุฑู) v2.0.x (Patch)
7. ุฏูุฌ โ ูุดุฑ ุชููุงุฆู Production
8. ูุฑุงูุจุฉ Post-Deploy (30 ุฏูููุฉ ุญุฑุฌุฉ)

## 6. ูุญูุต ูุง ูุจู ุงููุดุฑ (Pre-Deploy Checklist)
- [ ] npm audit (ูุง Critical)
- [ ] npm run lint & type-check
- [ ] npm run test
- [ ] ูุฑุงุฌุนุฉ CHANGELOG.md ูุญุฏุซ
- [ ] ูุง ุชุบููุฑุงุช ูู ุงููููุงุช ุงููุญููุฉ ุชุฎุงูู `VERSION-LOCK-V2.0.md`

## 7. ูุญูุต ูุง ุจุนุฏ ุงููุดุฑ (Post-Deploy)
| ุงูุฒูู | ุงููุญุต | ุงูุฅุฌุฑุงุก ูู ุญุงู ุงููุดู |
|-------|-------|----------------------|
| +5m | ุตุญุฉ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (200) | ุฅุนุงุฏุฉ ุงููุดุฑ ุฃู ุงูุชุฑุงุฌุน |
| +10m | ูุนุฏูุงุช ุงูุฎุทุฃ Sentry | ูุชุญ ุญุงุฏุซ Incident |
| +15m | ุฃุฏุงุก LCP / FCP | ุฅูุดุงุก ุจุทุงูุฉ ุชุญุณูู |
| +30m | ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุดูุงูู ุฏุนู | ุชุญุฏูุซ ุณุฌู ุงููุดุฑ |

## 8. ุฅุณุชุฑุงุชูุฌูุฉ ุงูุชุฑุงุฌุน (Rollback)
| ุงูุณููุงุฑูู | ุขููุฉ | ุฒูู ุงููุฑุงุฑ |
|-----------|-------|-------------|
| ุฎุทุฃ ุญุฑุฌ (500 ูุชูุฑุฑ) | ุฅุนุงุฏุฉ ูุดุฑ ุงูุฅุตุฏุงุฑ ุงูุณุงุจู (Vercel Re-deploy Previous) | โค 10 ุฏูุงุฆู |
| ุชุณุนูุฑ ุฎุงุทุฆ | ุชุนุทูู ุงููุณุงุฑ ุงููุชุฃุซุฑ + Hotfix Patch | โค 30 ุฏูููุฉ |
| ูุดู ุณุฑ | ุชุฏููุฑ ุงูุณุฑ + ุฅุจุทุงู ุงูุฌูุณุงุช | ููุฑู |

ุฎุทูุงุช ุนูููุฉ:
1. ุชุญุฏูุฏ ุขุฎุฑ Deploy ID ูุณุชูุฑ ูู Vercel
2. ุชูููุฐ Redeploy
3. ุชูุซูู ุงูุณุจุจ ูู Incident Log
4. ูุชุญ ุชุฐูุฑุฉ ุฌุฐุฑ ุงูุณุจุจ (RCA)

## 9. ุฅุฏุงุฑุฉ ุงูุฅุตุฏุงุฑุงุช (Versioning)
- Patch: ุฅุตูุงุญุงุช ูุซุงุฆู ุฃู UI ุจุณูุทุฉ (v2.0.x)
- Minor (2.1): ุชุชุจุน ูุนุงููุฑ ูุชุญ ุงูุฅุตุฏุงุฑ (ุงูุธุฑ Version Lock)
- ูุง Major ูุจู ุฌูุน ูุคุดุฑุงุช ุชุฃุซูุฑ ูุชุนุฏุฏุฉ

## 10. ุงููุชุบูุฑุงุช ูุงูุฃุณุฑุงุฑ (Secrets)
| ุงููุฆุฉ | ุงููุตุฏุฑ | ุงูุชุฎุฒูู | ุงูุชุฏููุฑ |
|-------|--------|---------|---------|
| Firebase Keys | Console | ูุชุบูุฑุงุช Vercel | ูุตู ุณููู |
| Vercel Tokens | Vercel | GitHub Secrets | ุฑุจุน ุณููู |
| Webhook Secrets | ุชูููุฏ ุฏุงุฎูู | Firestore (ูุดูุฑ) | ุนูุฏ ุงูุดู |
| API Internal Keys | ุชูููุฏ ุฏุงุฎูู | Secret Manager (ูุณุชูุจูุงู) | ุณููู |

## 11. ุงุฎุชุจุงุฑุงุช ุงูุฏุฎุงู (Smoke Tests)
ุชุดุบูู (ุขูู ูุณุชูุจูุงู):
- GET /health
- GET /version
- ุงุณุชุนูุงู Firestore ุจุณูุท
- ุฑูุน ููู ุตุบูุฑ

## 12. ูุฑุงูุจุฉ ูุง ุจุนุฏ ุงูุฅุตุฏุงุฑ (30 ุฏูููุฉ ุฃููู)
| ูุคุดุฑ | ุญุฏ ุชูุจูู | ููุงุฉ |
|------|----------|-------|
| ุฃุฎุทุงุก Sentry | >5 ูู 5 ุฏูุงุฆู | #alerts |
| ุฒูู ุงุณุชุฌุงุจุฉ Projects API | >800ms P95 | #alerts |
| ุฃุฎุทุงุก ุฑูุน Storage | >2% | #alerts |

## 13. ุงูุณุฌูุงุช (Logs)
- GitHub Actions: ุณุฌู ุงูุจูุงุก/ุงูุงุฎุชุจุงุฑุงุช
- Vercel Logs: ุทูุจุงุช HTTP
- Sentry: ุฃุฎุทุงุก + ุฃุฏุงุก

## 14. ุชุญุณููุงุช ูุณุชูุจููุฉ
- [ ] ุงุนุชูุงุฏ Canary Releases
- [ ] ูุญุต ุชููุงุฆู ููุณุชูู ุชุบุทูุฉ ุงูููุฏ
- [ ] ูุดุฑ ุฃุฒุฑู/ุฃุฎุถุฑ (Blue/Green) ูููุธุงุฆู ุงูุญุณุงุณุฉ

> ุขุฎุฑ ุชุญุฏูุซ: 2025-08-21
