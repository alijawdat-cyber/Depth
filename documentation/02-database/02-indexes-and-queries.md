# ๐๏ธ ุงูููุงุฑุณ ูุงูุงุณุชุนูุงูุงุช (Indexes & Queries) - Firestore V2.0

ูุฐุง ุงูููู ูุนุฑูู ุงูููุงุฑุณ ุงููุทููุจุฉ ูุงูุฃูุซูุฉ ุงููุนุชูุฏุฉ ููุงุณุชุนูุงู ูู Firestore ูุฏุนู ุฃุฏุงุก ูุณุชูุฑ ููุชููุน.

## 1. ูุจุงุฏุฆ ุชุตููู ุงูููุฑุณุฉ
1. ุชุฌููุจ ุงูููุงุฑุณ ุงูุนุดูุงุฆูุฉ ููู ุญูู โ ุฒูุงุฏุฉ ุงูุชูููุฉ.
2. ููุฑุณ ูุฑูุจ ููุท ุนูุฏ ุงุณุชุนูุงู ุญูููู ุซุงุจุช.
3. ูุง ุชุณุชุฎุฏู ูู where + orderBy ููุณ ุงูุญูู ุจุงุชุฌุงู ูุฎุชูู ุฏูู ุญุงุฌุฉ.
4. ุงูุญุฏ ูู ุงูุงุณุชุนูุงูุงุช ูุงุณุนุฉ ุงููุฌุงู (Collection Group) ุฅูุง ููุจุญุซ ุงูุนุฑุถู.

## 2. ุงูููุงุฑุณ ุงูููุชุฑุญุฉ (Composite Indexes)
| ุงููุฌููุนุฉ | ุงูุญููู (ุงูุชุฑุชูุจ) | ุณููุงุฑูู ุงูุงุณุชุฎุฏุงู |
|----------|------------------|--------------------|
| projects | status ASC, createdAt DESC | ููุญุฉ ุงููุดุงุฑูุน ุญุณุจ ุงูุญุงูุฉ ุงูุฃุญุฏุซ |
| projects | clientId ASC, createdAt DESC | ูุชุงุจุนุฉ ูุดุงุฑูุน ุนููู |
| projects | creatorId ASC, status ASC | ูุดุงุฑูุน ูุจุฏุน ุญุณุจ ุงูุญุงูุฉ |
| projectRequests | status ASC, createdAt DESC | ูุฑุงุฌุนุฉ ุงูุทูุจุงุช ุงููุงุฑุฏุฉ |
| creators | experience ASC, equipmentTier ASC | ุชุตููุฉ ุงูููุงูุจ |
| notifications | userId ASC, createdAt DESC | ุตูุฏูู ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู |
| messages | threadId ASC, createdAt ASC | ุชุฏูู ูุญุงุฏุซุฉ ูุฑุชุจ |
| sessions | userId ASC, createdAt DESC | ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช / ุงูุฃูู |

> ุชูุถุจุท ุนุจุฑ Firebase Console ุฃู firestore.indexes.json ูุงุญูุงู.

## 3. ุฃูุซูุฉ ุงุณุชุนูุงูุงุช ูููุฐุฌูุฉ
### 3.1 ูุดุงุฑูุน ูุจุฏุน ูุดุทุฉ
```js
const q = query(
  collection(db, 'projects'),
  where('creatorId', '==', creatorId),
  where('status', 'in', ['active','pending']),
  orderBy('status'),
  orderBy('createdAt', 'desc'),
  limit(20)
);
```

### 3.2 ูุดุงุฑูุน ุนููู ููุชููุฉ (ุตูุญุฉ ุซุงููุฉ)
```js
const q = query(
  collection(db, 'projects'),
  where('clientId', '==', clientId),
  where('status', '==', 'completed'),
  orderBy('createdAt', 'desc'),
  startAfter(lastSnapshot),
  limit(20)
);
```

### 3.3 ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ ุบูุฑ ููุฑูุกุฉ
```js
const q = query(
  collection(db, 'notifications'),
  where('userId', '==', userId),
  where('isRead', '==', false),
  orderBy('createdAt', 'desc'),
  limit(50)
);
```

### 3.4 ุชุตููุฉ ูุจุฏุนูู
```js
const q = query(
  collection(db, 'creators'),
  where('experience', 'in', ['experienced','expert']),
  where('categories', 'array-contains', 'photo'),
  orderBy('experience'),
  limit(30)
);
```

### 3.5 ุฌูุณุงุช ูุณุชุฎุฏู ุญุฏูุซุฉ
```js
const q = query(
  collection(db, 'sessions'),
  where('userId', '==', userId),
  orderBy('createdAt', 'desc'),
  limit(10)
);
```

## 4. ุงุนุชุจุงุฑุงุช ุงูุฃุฏุงุก
| ุงูุญุงูุฉ | ุงูุฎุทุฑ | ุงูุชุฎููู |
|--------|-------|---------|
| ุงุณุชุนูุงูุงุช broad ุจุฏูู where | ุงุณุชููุงู ูุฑุงุกุฉ ุนุงูู | ุฅุถุงูุฉ where ุถูู ุฃููุงู |
| array-contains-any ูุจุงูุบ ุจู | ููุฑุณุฉ ุฅุถุงููุฉ ููููุฉ | ุชูุญูุฏ ุงููุณูู ุงูุฃุณุงุณูุฉ |
| ุงูุญุฌู ุงููุชุฒุงูุฏ ูู projects | ุชุจุงุทุค ุงุณุชุนูุงูุงุช | ุฃุฑุดูุฉ ุณูููุฉ ุฅูู ูุฌููุนุฉ ูููุตูุฉ |
| ูุญุงุฏุซุงุช ุถุฎูุฉ | ุชุญููู ูุชุฏุฑุฌ ุจุทูุก | ุชูุณูู threads ุญุณุจ ุณูุฉ |

## 5. ุฃุฑุดูุฉ (Archival Strategy)
| ุงูููุงู | ูุนุงููุฑ ุงูููู | ุงููุฌูุฉ |
|--------|--------------|---------|
| projects | > 12 ุดูุฑ ูููุชูู | projects_archive |
| notifications | > 90 ููู ูููุฑูุก | ุญุฐู ุฃู ุชุฎุฒูู ุจุงุฑุฏ |
| sessions | ููุชููุฉ > 30 ููู | ุญุฐู |
| logs (ุฎุงุฑุฌู) | > 30/90 ููู | ูุธุงู ุฎุงุฑุฌู (BigQuery) |

## 6. ุญุฏูุฏ ุชุดุบูููุฉ (Guardrails)
| ุงูุจูุฏ | ุงููููุฉ ุงููุณุชูุฏูุฉ |
|-------|------------------|
| ุฃูุตู ุญุฌู ูุณุชูุฏ Project | < 32 KB |
| ุฃูุตู ุนุฏุฏ Subcollections ูููุดุฑูุน | 3 (deliverables, comments, audits) |
| ุฃูุตู ุนูุงุตุฑ ูู Array (tags) | 30 |
| ุทูู ุงูุณุฌู ูู messages | < 5 KB |

## 7. ูุฑุงูุจุฉ (Monitoring Hooks)
- ููุงุณ ุฒูู ุงูุงุณุชุนูุงู P95 ุดูุฑู.
- ุชูุจูู ุฅุฐุง ูุนุฏู ุงููุฑุงุกุฉ > ุนุชุจุฉ ูุชูู ุนูููุง.
- ููุญุฉ ููู Hot Collections (ุงูุงุณุชุฎุฏุงู ุงูุฃุนูู).

## 8. ุฎุงุฑุทุฉ ูุณุชูุจููุฉ
- ููู ุงูุชุญูููุงุช ุงูุซูููุฉ ุฅูู BigQuery Export.
- ุฏุนู ูุคุดุฑุงุช ุจุญุซ ูุตู (Integrations ูุงุญูุงู) ุนูุฏ ุงูุญุงุฌุฉ.

> ุขุฎุฑ ุชุญุฏูุซ: 2025-08-21
