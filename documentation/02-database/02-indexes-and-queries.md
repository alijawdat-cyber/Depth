# ๐๏ธ ุงูููุงุฑุณ ูุงูุงุณุชุนูุงูุงุช (Indexes & Queries) - Firestore V2.1

ูุฐุง ุงูููู ูุนุฑูู ุงูููุงุฑุณ ุงููุทููุจุฉ ูุงูุฃูุซูุฉ ุงููุนุชูุฏุฉ ููุงุณุชุนูุงู ูู Firestore ูุฏุนู ุฃุฏุงุก ูุณุชูุฑ ููุชููุนุ ูุน ุฏุนู ูุธุงู ุงููุดุงุฑูุน ูุชุนุฏุฏุฉ ุงูููุงู.

## 1. ูุจุงุฏุฆ ุชุตููู ุงูููุฑุณุฉ
1. ุชุฌููุจ ุงูููุงุฑุณ ุงูุนุดูุงุฆูุฉ ููู ุญูู โ ุฒูุงุฏุฉ ุงูุชูููุฉ.
2. ููุฑุณ ูุฑูุจ ููุท ุนูุฏ ุงุณุชุนูุงู ุญูููู ุซุงุจุช.
3. ูุง ุชุณุชุฎุฏู ูู where + orderBy ููุณ ุงูุญูู ุจุงุชุฌุงู ูุฎุชูู ุฏูู ุญุงุฌุฉ.
4. ุงูุญุฏ ูู ุงูุงุณุชุนูุงูุงุช ูุงุณุนุฉ ุงููุฌุงู (Collection Group) ุฅูุง ููุจุญุซ ุงูุนุฑุถู.

## 2. ุงูููุงุฑุณ ุงูููุชุฑุญุฉ (Composite Indexes)
| ุงููุฌููุนุฉ | ุงูุญููู (ุงูุชุฑุชูุจ) | ุณููุงุฑูู ุงูุงุณุชุฎุฏุงู |
|----------|------------------|--------------------|
| projects | status ASC, createdAt DESC | ููุญุฉ ุงููุดุงุฑูุน ุญุณุจ ุงูุญุงูุฉ ุงูุฃุญุฏุซ |
| projects | clientId ASC, createdAt DESC | ูุชุงุจุนุฉ ูุดุงุฑูุน ุนููู |
| projects | creatorId ASC, status ASC | ูุดุงุฑูุน ูุจุฏุน ุญุณุจ ุงูุญุงูุฉ |
| projects | industryId ASC, status ASC | ูุดุงุฑูุน ุญุณุจ ุงููุฌุงู ุงูุตูุงุนู |
| projectRequests | status ASC, createdAt DESC | ูุฑุงุฌุนุฉ ุงูุทูุจุงุช ุงููุงุฑุฏุฉ |
| tasks | projectId ASC, status ASC | ููุงู ูุดุฑูุน ูุญุฏุฏ |
| tasks | assignedCreatorId ASC, status ASC | ููุงู ูุจุฏุน ูุญุฏุฏ |
| tasks | subcategoryId ASC, status ASC | ููุงู ูุฆุฉ ูุฑุนูุฉ |
| tasks | status ASC, dueDate ASC | ููุงู ุญุณุจ ุงูููุงุนูุฏ ุงูููุงุฆูุฉ |
| tasks | projectId ASC, priority DESC, createdAt DESC | ุชุฑุชูุจ ููุงู ุงููุดุฑูุน ุจุงูุฃููููุฉ |
| creatorRecommendations | projectId ASC, score DESC | ุชูุตูุงุช ูุดุฑูุน ูุฑุชุจุฉ ุจุงูููุงุท |
| creatorRecommendations | creatorId ASC, status ASC | ุชูุตูุงุช ูุจุฏุน ุงููุดุทุฉ |
| creatorRecommendations | status ASC, expiresAt ASC | ุชูุตูุงุช ููุชููุฉ ุงูุตูุงุญูุฉ |
| creatorRecommendations | projectId ASC, adminReview ASC, score DESC | ุชูุตูุงุช ุชุญุชุงุฌ ูุฑุงุฌุนุฉ |
| creators | experienceLevel ASC, equipmentTier ASC | ุชุตููุฉ ุงูููุงูุจ |
| creators | onboardingStatus ASC, createdAt DESC | ูุชุงุจุนุฉ ุทูุจุงุช ุงูุงูุถูุงู |
| creators | isAvailable ASC, rating DESC | ุงูุจุญุซ ุนู ุงููุจุฏุนูู ุงููุชุงุญูู |
| creatorSubcategories | creatorId ASC, isActive ASC | ูุฆุงุช ุงููุจุฏุน ุงููุดุทุฉ |
| creatorSubcategories | subcategoryId ASC, isActive ASC | ุงููุจุฏุนูู ูู ูุฆุฉ ูุนููุฉ |
| notifications | recipientId ASC, createdAt DESC | ุตูุฏูู ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏู |
| notifications | recipientId ASC, isRead ASC, createdAt DESC | ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงูููุฑูุกุฉ |
| creatorAvailability | creatorId ASC, date ASC | ุฌุฏูู ุชููุฑ ุงููุจุฏุน |
| creatorAvailability | creatorId ASC, status ASC, date ASC | ุงูุจุญุซ ุนู ุฃููุงุช ูุชุงุญุฉ |
| sessions | userId ASC, isActive ASC, createdAt DESC | ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ุงููุดุทุฉ |
| sessions | userId ASC, createdAt DESC | ุชุงุฑูุฎ ุฌูุณุงุช ุงููุณุชุฎุฏู |
| reviews | projectId ASC, createdAt DESC | ุชููููุงุช ุงููุดุฑูุน |
| reviews | revieweeId ASC, rating DESC | ุชููููุงุช ุงููุจุฏุน/ุงูุนููู |
| invoices | status ASC, dueDate DESC | ูุชุงุจุนุฉ ุงูุงุณุชุญูุงูุงุช ูุงููุชุฃุฎุฑ |
| invoices | clientId ASC, createdAt DESC | ููุงุชูุฑ ุนููู ุญุณุจ ุงูุฃุญุฏุซ |
| payments | invoiceId ASC, receivedAt DESC | ูุดู ูุฏููุนุงุช ุงููุงุชูุฑุฉ |

> ุชูุถุจุท ุนุจุฑ Firebase Console ุฃู firestore.indexes.json ูุงุญูุงู.

## 3. ุฃูุซูุฉ ุงุณุชุนูุงูุงุช ูููุฐุฌูุฉ
### 3.1 ูุดุงุฑูุน ูุจุฏุน ูุดุทุฉ
```js
const q = query(
  collection(db, 'projects'),
  where('creatorId', '==', creatorId),
  where('status', 'in', ['active','pending']),
  orderBy('status'),
  orderBy('createdAt', 'desc'),
  limit(20)
);
```

### 3.2 ูุดุงุฑูุน ุนููู ููุชููุฉ (ุตูุญุฉ ุซุงููุฉ)
```js
const q = query(
  collection(db, 'projects'),
  where('clientId', '==', clientId),
  where('status', '==', 'completed'),
  orderBy('createdAt', 'desc'),
  startAfter(lastSnapshot),
  limit(20)
);
```

### 3.3 ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ ุบูุฑ ููุฑูุกุฉ
```js
const q = query(
  collection(db, 'notifications'),
  where('recipientId', '==', userId),
  where('isRead', '==', false),
  orderBy('createdAt', 'desc'),
  limit(50)
);
```

### 3.4 ุงูุจุญุซ ุนู ูุจุฏุนูู ูุชุงุญูู ูู ูุฆุฉ ูุนููุฉ
```js
const q = query(
  collection(db, 'creatorSubcategories'),
  where('subcategoryId', '==', subcategoryId),
  where('isActive', '==', true)
);

// ุซู ุฌูุจ ุชูุงุตูู ุงููุจุฏุนูู
const creatorIds = results.map(doc => doc.data().creatorId);
const creatorsQuery = query(
  collection(db, 'creators'),
  where('id', 'in', creatorIds),
  where('isAvailable', '==', true),
  orderBy('rating', 'desc'),
  limit(10)
);
```

### 3.5 ุฌูุณุงุช ูุณุชุฎุฏู ูุดุทุฉ
```js
const q = query(
  collection(db, 'sessions'),
  where('userId', '==', userId),
  where('isActive', '==', true),
  orderBy('lastActivity', 'desc'),
  limit(5)
);
```

### 3.6 ุชููุฑ ุงููุจุฏุน ูู ููู ูุนูู
```js
const q = query(
  collection(db, 'creatorAvailability'),
  where('creatorId', '==', creatorId),
  where('date', '==', targetDate),
  orderBy('timeSlot', 'asc')
);
```

### 3.7 ุทูุจุงุช ุงููุดุงุฑูุน ุงููุนููุฉ ูููุฑุงุฌุนุฉ
```js
const q = query(
  collection(db, 'projectRequests'),
  where('status', '==', 'pending'),
  orderBy('createdAt', 'asc'),
  limit(20)
);
```

### 3.8 ููุงู ูุดุฑูุน ูุญุฏุฏ ูุฑุชุจุฉ ุจุงูุฃููููุฉ
```js
const q = query(
  collection(db, 'tasks'),
  where('projectId', '==', projectId),
  orderBy('priority', 'desc'),
  orderBy('createdAt', 'desc'),
  limit(50)
);
```

### 3.9 ููุงู ูุจุฏุน ูุดุทุฉ
```js
const q = query(
  collection(db, 'tasks'),
  where('assignedCreatorId', '==', creatorId),
  where('status', 'in', ['pending', 'in_progress']),
  orderBy('dueDate', 'asc'),
  limit(20)
);
```

### 3.10 ุชูุตูุงุช ุฐููุฉ ููุดุฑูุน ูุฑุชุจุฉ ุจุงูููุงุท
```js
const q = query(
  collection(db, 'creatorRecommendations'),
  where('projectId', '==', projectId),
  where('status', '==', 'active'),
  orderBy('score', 'desc'),
  limit(10)
);
```

### 3.11 ุชูุตูุงุช ูุจุฏุน ุงููุดุทุฉ
```js
const q = query(
  collection(db, 'creatorRecommendations'),
  where('creatorId', '==', creatorId),
  where('status', '==', 'active'),
  where('expiresAt', '>', new Date()),
  orderBy('score', 'desc'),
  limit(15)
);
```

### 3.12 ูุดุงุฑูุน ูุชุนุฏุฏุฉ ุงูููุงู ุงููุดุทุฉ
```js
const q = query(
  collection(db, 'projects'),
  where('status', 'in', ['active', 'pending']),
  orderBy('createdAt', 'desc'),
  limit(25)
);
```

### 3.13 ููุงู ูุชุฃุฎุฑุฉ ุนู ุงูููุงุนูุฏ ุงูููุงุฆูุฉ
```js
const q = query(
  collection(db, 'tasks'),
  where('status', 'in', ['pending', 'in_progress']),
  where('dueDate', '<', new Date()),
  orderBy('dueDate', 'asc'),
  limit(30)
);
```

## 4. ุงุนุชุจุงุฑุงุช ุงูุฃุฏุงุก
| ุงูุญุงูุฉ | ุงูุฎุทุฑ | ุงูุชุฎููู |
|--------|-------|---------|
| ุงุณุชุนูุงูุงุช broad ุจุฏูู where | ุงุณุชููุงู ูุฑุงุกุฉ ุนุงูู | ุฅุถุงูุฉ where ุถูู ุฃููุงู |
| array-contains-any ูุจุงูุบ ุจู | ููุฑุณุฉ ุฅุถุงููุฉ ููููุฉ | ุชูุญูุฏ ุงููุณูู ุงูุฃุณุงุณูุฉ |
| ุงูุญุฌู ุงููุชุฒุงูุฏ ูู projects | ุชุจุงุทุค ุงุณุชุนูุงูุงุช | ุฃุฑุดูุฉ ุณูููุฉ ุฅูู ูุฌููุนุฉ ูููุตูุฉ |
| tasks ูุจูุฑุฉ | ุจุทุก ูู ุงูุจุญุซ | ููุฑุณุฉ ูุฑูุจุฉ ุนูู projectId + status |
| creatorRecommendations ูุชุฑุงููุฉ | ุงุณุชููุงู ุฐุงูุฑุฉ | ุชูุธูู ุฏูุฑู ููููุชููุฉ ุงูุตูุงุญูุฉ |
| creatorSubcategories ูุจูุฑุฉ | ุจุทุก ูู ุงูุจุญุซ | ููุฑุณุฉ ูุฑูุจุฉ ุนูู creatorId + subcategoryId |
| notifications ูุชุฑุงููุฉ | ุฐุงูุฑุฉ ุนุงููุฉ | ุชูุธูู ุฏูุฑู ููููุฑูุกุฉ ุงููุฏููุฉ |

## 5. ุฃุฑุดูุฉ (Archival Strategy)
| ุงูููุงู | ูุนุงููุฑ ุงูููู | ุงููุฌูุฉ |
|--------|--------------|---------|
| projects | > 12 ุดูุฑ ูููุชูู | projects_archive |
| tasks | ูุดุฑูุน ููุชูู > 6 ุดููุฑ | tasks_archive |
| creatorRecommendations | ููุชููุฉ ุงูุตูุงุญูุฉ > 30 ููู | ุญุฐู |
| notifications | > 90 ููู ูููุฑูุก | ุญุฐู ุฃู ุชุฎุฒูู ุจุงุฑุฏ |
| sessions | ููุชููุฉ > 30 ููู | ุญุฐู |
| creatorAvailability | > 6 ุดููุฑ | ุญุฐู (ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ) |
| otpCodes | ููุชููุฉ ุงูุตูุงุญูุฉ > 24 ุณุงุนุฉ | ุญุฐู |
| reviews | ูุง ุญุงุฌุฉ ูุฃุฑุดูุฉ | ุงูุงุญุชูุงุธ ุงูุฏุงุฆู |

## 6. ุญุฏูุฏ ุชุดุบูููุฉ (Guardrails)
| ุงููููุฉ | ุงููููุฉ ุงููุณุชูุฏูุฉ |
|-------|------------------|
| ุฃูุตู ุญุฌู ูุณุชูุฏ Project | < 40 KB (ุฒูุงุฏุฉ ูุฏุนู Tasks) |
| ุฃูุตู ุนุฏุฏ Tasks ูููุดุฑูุน | 50 ูููุฉ |
| ุฃูุตู ุนุฏุฏ Subcollections ูููุดุฑูุน | 4 (tasks, deliverables, comments, audits) |
| ุฃูุตู ุนุฏุฏ ุชูุตูุงุช ููู ูุดุฑูุน | 20 ุชูุตูุฉ |
| ุฃูุตู ุนูุงุตุฑ ูู Array (specialties) | 10 |
| ุฃูุตู ุนูุงุตุฑ ูู Array (portfolioImages) | 10 |
| ุฃูุตู ุทูู ุงููุต ูู ุงูุชุนูููุงุช | 1000 ุญุฑู |
| ุฃูุตู ูุฆุงุช ูุฑุนูุฉ ูููุจุฏุน | 20 |
| ุฃูุตู ุนุฏุฏ ุฌูุณุงุช ูุดุทุฉ ูููุณุชุฎุฏู | 5 |

## 7. ูุฑุงูุจุฉ (Monitoring Hooks)
- ููุงุณ ุฒูู ุงูุงุณุชุนูุงู P95 ุดูุฑู.
- ุชูุจูู ุฅุฐุง ูุนุฏู ุงููุฑุงุกุฉ > ุนุชุจุฉ ูุชูู ุนูููุง.
- ููุญุฉ ููู Hot Collections (ุงูุงุณุชุฎุฏุงู ุงูุฃุนูู).
- ูุฑุงูุจุฉ ุงุณุชููุงู tasks ูููุดุงุฑูุน ุงููุจูุฑุฉ.
- ุชุชุจุน ุฏูุฉ ูุธุงู ุงูุชูุตูุงุช ุงูุฐููุฉ.

## 8. ุฎุงุฑุทุฉ ูุณุชูุจููุฉ
- ููู ุงูุชุญูููุงุช ุงูุซูููุฉ ุฅูู BigQuery Export.
- ุฏุนู ูุคุดุฑุงุช ุจุญุซ ูุตู (Algolia/Elasticsearch) ููุจุญุซ ุงููุชูุฏู.
- ุชุญุณูู ุงุณุชุนูุงูุงุช CreatorSubcategories ุจู Collection Group Queries.
- ุฅุถุงูุฉ Real-time Listeners ููุชููุฑ ุงูุดุจูู.
- ุชุทููุฑ ูุธุงู ุงูุชูุตูุงุช ุงูุฐููุฉ ุจุงุณุชุฎุฏุงู Machine Learning.
- ุฏุนู ุชุญูููุงุช ุงููุดุงุฑูุน ูุชุนุฏุฏุฉ ุงูููุงู.

> ุขุฎุฑ ุชุญุฏูุซ: 2025-09-04 (V2.1)
