# 🔐 نموذج التهديد (Threat Model) - V2.0 (مبدئي)

هذا النموذج مبدئي ويغطي أهم التهديدات وفق منهجية مبسطة مستوحاة من STRIDE.

## 1. النطاق
يغطي: المصادقة، البيانات الحساسة (PII)، التسعير، إدارة الملفات، الإشعارات، المراسلة.

## 2. تصنيف資 الأصول (Assets)
| الأصل | القيمة | ملاحظات |
|-------|--------|---------|
| حسابات المستخدمين | عالية | تتضمن PII |
| مشروع + التسعير | عالية | سرية تسعير الوكالة |
| ملفات وسائط | متوسطة | قد تحوي مواد حساسة تجارياً |
| سجلات الجلسات | عالية | أمن جلسات وصلاحيات |
| رسائل داخلية | متوسطة | تواصل تشغيل |

## 3. تهديدات رئيسية (مختارة)
| التهديد | التصنيف | الوصف | التخفيف |
|---------|---------|-------|---------|
| سرقة توكن (Token Theft) | انتحال | استخدام توكن مسروق | تقصير عمر Access + Refresh Rotation |
| تجاوز صلاحيات (Privilege Escalation) | رفع امتياز | استغلال ضعف تحقق الدور | RBAC صارم + اختبارات أمنية |
| حقن إدخال (Input Injection) | تلاعب بيانات | إدخال نصوص خبيثة بالحقل | Sanitization + Validation |
| كشف PII عبر Logs | إفشاء | تسجيل حقول حساسة | Masking + تصنيف الحقول |
| هجوم قوة غاشمة (Brute Force OTP) | تجاوز مصادقة | تخمين OTP | معدل محاولات + تبريد (Cooldown) |
| إعادة تشغيل طلب (Replay) | تلاعب جلسة | إرسال نفس الطلب المالي | Idempotency Keys |
| تحميل ملفات خبيثة | تنفيذ | رفع برمجيات أو مستندات خطرة | نوع MIME + AV Scan (مستقبلي) |
| تسريب مفاتيح بيئة | إفشاء | رفع ملف .env | Git Ignore + فحص CI |
| قراءة غير مصرح (Insecure Direct Object) | كشف بيانات | تخمين معرف مشروع | تحقق ملكية + Access Filters |
| تضخيم تكلفة (Cost Abuse) | إساءة | استدعاءات API كثيفة | Rate Limits + Alerts |

## 4. مصفوفة مخاطر (تبسيط: احتمال × أثر)
| التهديد | الاحتمال | الأثر | مستوى | إجراء |
|---------|----------|-------|-------|-------|
| Token Theft | متوسط | عالٍ | عالي | مراقبة + دورات توكن |
| Privilege Escalation | منخفض | عالٍ | متوسط/عالٍ | مراجعة أذونات دورية |
| OTP Brute Force | متوسط | متوسط | متوسط | ضبط المحاولات + حظر مؤقت |
| File Malware | منخفض | عالي | متوسط | فحص لاحق AV |
| Replay Payment | منخفض | عالي | متوسط | Idempotency دائم |
| PII Log Leakage | متوسط | عالي | عالي | تدقيق Logging الآن |

## 5. عناصر يجب تنفيذها قريباً
| البند | الأولوية | وصف |
|-------|----------|-----|
| Masking للـ PII في Logs | عالي | إزالة القيم أو تجزئتها |
| Webhook Signing | متوسط | توقيع سري للتحقق |
| CSP Headers | متوسط | حماية واجهة الويب |
| Key Rotation Schedule | متوسط | دورة كل 90 يوم |
| Secret Scanning في CI | عالي | كاشف تسرب مبكر |

## 6. خطة تحسين مرحلية
1. تفعيل تنبيه قراءة غير اعتيادية (sessions per user spike).
2. إدخال Layer لرفض Content-Type غير مسموح.
3. مراقبة نسبة الأخطاء 401/403 (تحليل محاولات فشل وصول). 
4. إعداد Playbook استجابة لحادثة تسرب مفتاح.

## 7. حدود النموذج الحالي
- لا يغطي هجمات DoS واسعة النطاق.
- لا يغطي تحليل تشفير متقدم (يُضاف في 2.1 لو توسع التهديد).
- لا توجد حالياً مصادقة ثنائية إجبارية (MFA اختيارية).

> آخر تحديث: 2025-08-21
