# ๐ช ููุงุตูุงุช ุงูู Webhooks - Depth V2.0

## 1. ุงููุฏู
ุชูููู ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ ูู ุงูุงุดุชุฑุงู ูู ุฃุญุฏุงุซ ุงูููุตุฉ (Projects, Creators, Pricing Adjustments) ุจุทุฑููุฉ ุขููุฉุ ููุซููุฉ ููุงุจูุฉ ูุฅุนุงุฏุฉ ุงููุญุงููุฉ.

## 2. ุงูุญุงูุฉ
Draft (ูุณููุญ ุถูู 2.0 ูุฃูู ููู ูุฑุฌุนู ูุง ูุบูุฑ ุณููู ุงูุฅูุชุงุฌ ุงููููู).

## 3. ุงูุฃุญุฏุงุซ (Events)
| ุงูููุชุงุญ | ุงููุตู | ูููุฐุฌ ุงูุญูููุฉ (Payload) |
|---------|-------|-------------------------|
| project.created | ุฅูุดุงุก ูุดุฑูุน | project.basic |
| project.status.changed | ุชุบููุฑ ุญุงูุฉ | project.statusChange |
| creator.approved | ุงุนุชูุงุฏ ูุจุฏุน | creator.approval |
| pricing.formula.version | ุชุบููุฑ (ูุณุชูุจูู) | pricing.version |

## 4. ุงูููุงุฐุฌ (Schemas)
```jsonc
// project.basic
{
  "id": "p_123",
  "clientId": "cl_1",
  "creatorId": "c_9",
  "status": "pending",
  "createdAt": "2025-08-21T12:00:00Z"
}

// project.statusChange
{
  "id": "p_123",
  "oldStatus": "pending",
  "newStatus": "active",
  "changedAt": "2025-08-21T13:00:00Z"
}

// creator.approval
{
  "id": "c_9",
  "approvedAt": "2025-08-21T12:30:00Z",
  "experience": "experienced",
  "equipmentTier": "gold"
}
```

## 5. ุงูุฅุนุฏุงุฏ (Subscription Flow)
1. ุงูุนููู ูุทูุจ ุฅูุดุงุก Endpoint (ูู ููุญุฉ ูุณุชูุจููุฉ)
2. ุชูููุฏ `webhookId` + `signingSecret`
3. ุงุฎุชุจุงุฑ (Ping) โ ูุฌุจ ุฅุนุงุฏุฉ 200 ุฎูุงู 5 ุซูุงูู
4. ุชูุนูู ุงูุงุดุชุฑุงู

## 6. ุงูุชูููุน (Signing)
ููุฑุณู ุฑุฃุณ:
```
X-Depth-Signature: v1=<HMAC_SHA256_HEX>
X-Depth-Timestamp: <unix_epoch_seconds>
```
ุฎูุงุฑุฒููุฉ ุงูุจูุงุก:
```
baseString = timestamp + "." + body
signature = HMAC_SHA256(signingSecret, baseString)
```
ุฑูุถ ุฅุฐุง:
- ูุฑู ุงูุฒูู > 5 ุฏูุงุฆู
- ููููุฏ ุฃู ุฑุฃุณ
- ุงูุชูููุน ูุง ูุทุงุจู

## 7. ุฅุนุงุฏุฉ ุงููุญุงููุฉ (Retries)
| ุงููุญุงููุฉ | ุงูุชุฃุฎูุฑ (ุซูุงูู) |
|----------|-----------------|
| 1 | 0 |
| 2 | 30 |
| 3 | 120 |
| 4 | 600 |

ูุชููู ุจุนุฏ 4 ูุญุงููุงุช ุฃู HTTP 2xx.

## 8. ุงูุชุณููู ุงููุนุชูุฏ (Idempotency)
ุฅุฑุณุงู ุฑุฃุณ:
```
X-Depth-Delivery-ID: <uuid4>
```
ุนูู ุงููุณุชูุจู ุญูุธ ID ููุฏุฉ 24 ุณุงุนุฉ ูุชุฌูุจ ุงููุนุงูุฌุฉ ุงูููุฑุฑุฉ.

## 9. ุงูุฃูู
- ุชูููุน ุฅูุฒุงูู
- IP Allowlist (ูุณุชูุจูู)
- ุชุณุฌูู ูุดู ุงูุชูููุน

## 10. ุฅุฏุงุฑุฉ ุงูุฅุตุฏุงุฑุงุช
ุฅุตุฏุงุฑ ุงูุญุฏุซ v1 ุฏุงุฎู 2.0 ุซุงุจุช (ูุง ูุณุฑ). ุฃู ุชุนุฏูู ุฌููุฑู ูุชุจุน ูุชุญ 2.1.

## 11. ุงููุฑุงูุจุฉ
ุชุฌููุน ุงูุฅุญุตุงุกุงุช:
```
webhookDeliveries/{id}:
  status, attempts, lastAttemptAt, latencyMs
```

## 12. ุญุฏูุฏ (Limits)
| ููุน | ูููุฉ |
|-----|------|
| ุญุฌู ุงูุญูููุฉ | 64KB |
| ุฒูู ุงูุงุณุชุฌุงุจุฉ | โค 5s |
| ูุนุฏู ุงูุญุฏ ุงูุฃุฏูู | 60/ุฏ ููู Endpoint |

## 13. ุฃูุซูุฉ ุทูุจ
```http
POST /webhooks/project.status.changed HTTP/1.1
Host: client-endpoint.io
Content-Type: application/json
X-Depth-Signature: v1=abc123...
X-Depth-Timestamp: 1724245200
X-Depth-Delivery-ID: 550e8400-e29b-41d4-a716-446655440000

{"id":"p_123","oldStatus":"pending","newStatus":"active","changedAt":"2025-08-21T13:00:00Z"}
```

## 14. ุฃุฎุทุงุก ุดุงุฆุนุฉ
| ุฑูุฒ | ุณุจุจ | ุญู |
|-----|-----|----|
| 400 | Timestamp ูุฏูู | ุชุญูู ูู ุงูุณุงุนุฉ |
| 401 | ุชูููุน ุบูุฑ ุตุญูุญ | ุชุฃูุฏ ูู ุงูุณุฑ |
| 429 | ูุนุฏู ูุฑุชูุน | Backoff |

## 15. ุชุญุณููุงุช ูุณุชูุจููุฉ
- [ ] ุชุดููุฑ ุนูู ูุณุชูู ุงูุญูู
- [ ] Event Version Header
- [ ] Self-serve Portal

> ุขุฎุฑ ุชุญุฏูุซ: 2025-08-21
